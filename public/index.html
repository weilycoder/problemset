<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Problem Set</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="stylesheet" href="/styles.css" />
</head>

<body>
    <main class="page">
        <section class="hero">
            <h1 class="title">Problem Set</h1>
            <a class="text-link" href="/submit">Submit a problem →</a>
        </section>

        <section class="panel">
            <div id="problem-list"></div>
            <div class="status" id="status-text">正在加载题目列表...</div>
        </section>
    </main>

    <script>
        async function fetchProblems() {
            const statusText = document.getElementById("status-text");
            const response = await fetch("/api/problems");
            if (response.ok) {
                const problems = await response.json();
                const problemListDiv = document.getElementById("problem-list");
                problemListDiv.innerHTML = "";
                if (problems.length === 0) {
                    statusText.textContent = "暂无题目，请稍后刷新。";
                    return;
                }
                statusText.textContent = "";
                problems.forEach(problem => {
                    // Use a div card so we can add a separate edit button inside the card
                    const problemCard = document.createElement("div");
                    problemCard.className = "problem-card";
                    problemCard.addEventListener("click", () => {
                        window.location.href = `/problem/${encodeURIComponent(problem)}`;
                    });

                    const name = document.createElement("div");
                    name.className = "problem-name";
                    name.textContent = problem;

                    const meta = document.createElement("div");
                    meta.className = "problem-id";
                    meta.textContent = "Problem";

                    const left = document.createElement("div");
                    left.appendChild(name);
                    left.appendChild(meta);

                    const arrow = document.createElement("div");
                    arrow.className = "problem-arrow";
                    arrow.textContent = "→";

                    const editBtn = document.createElement("button");
                    editBtn.className = "problem-edit";
                    editBtn.type = "button";
                    editBtn.textContent = "编辑";
                    editBtn.title = "编辑题目";
                    editBtn.addEventListener("click", (e) => {
                        e.stopPropagation();
                        window.location.href = `/submit?id=${encodeURIComponent(problem)}`;
                    });

                    const right = document.createElement("div");
                    right.className = "problem-actions";
                    right.appendChild(editBtn);
                    right.appendChild(arrow);

                    problemCard.appendChild(left);
                    problemCard.appendChild(right);
                    problemListDiv.appendChild(problemCard);
                });
            } else {
                statusText.textContent = "题目加载失败，请检查服务状态。";
                console.error("Failed to fetch problems:", response.statusText);
            }
        }

        fetchProblems();
    </script>
</body>

</html>